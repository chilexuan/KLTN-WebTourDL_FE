
<div class="dashboard-container">
  <!-- Header -->
  <header class="header-section">
    <div class="header-content">
      <div class="header-flex">
        <div class="header-info">
          <h1><i class="fas fa-map-marked-alt"></i>Travel Dashboard</h1>
          <p>Quản lý hệ thống du lịch của bạn</p>
        </div>
        <button class="logout-btn" (click)="logout()">
          <i class="fas fa-sign-out-alt"></i>Đăng xuất
        </button>
      </div>
    </div>
  </header>

  <div class="main-content">
    <!-- Stats Grid -->
    <div class="stats-grid">
      <div class="stat-card stat-users">
        <div class="stat-icon">
          <i class="fas fa-users"></i>
        </div>
        <div class="stat-content">
          <h3>{{stats.totalUsers}}</h3>
          <p>Tổng số người dùng</p>
        </div>
      </div>
      <div class="stat-card stat-articles">
        <div class="stat-icon">
          <i class="fas fa-newspaper"></i>
        </div>
        <div class="stat-content">
          <h3>{{stats.totalArticles}}</h3>
          <p>Tổng số bài viết</p>
        </div>
      </div>
      <div class="stat-card stat-tours">
        <div class="stat-icon">
          <i class="fas fa-route"></i>
        </div>
        <div class="stat-content">
          <h3>0</h3>
          <p>Tổng số tour</p>
        </div>
      </div>
    </div>

    <!-- Navigation Tabs -->
    <div class="nav-tabs-container">
      <button 
        class="nav-tab" 
        [class.active]="activeTab === 'articles'" 
        (click)="switchTab('articles')">
        <i class="fas fa-newspaper"></i>
        <span>Quản lý bài viết</span>
      </button>
      <button 
        class="nav-tab" 
        [class.active]="activeTab === 'users'" 
        (click)="switchTab('users')">
        <i class="fas fa-users"></i>
        <span>Quản lý người dùng</span>
      </button>
    </div>

    <!-- Articles Tab -->
    <div *ngIf="activeTab === 'articles'" class="tab-content">
      <!-- Article Form -->
      <div class="content-card">
        <div class="card-header">
          <div class="card-title">
            <i class="fas fa-plus-circle"></i>
            <h5>{{editingArticle ? 'Chỉnh sửa bài viết' : 'Tạo bài viết mới'}}</h5>
          </div>
        </div>
        <div class="card-body">
          <form (ngSubmit)="editingArticle ? editArticle() : createArticle()" class="article-form">
            <div class="form-row">
              <div class="form-group">
                <label for="articleTitle">Tiêu đề</label>
                <input 
                  type="text" 
                  id="articleTitle" 
                  [(ngModel)]="newArticle.title" 
                  name="title" 
                  placeholder="Nhập tiêu đề bài viết"
                  [ngClass]="{'invalid': errors.title}">
                <span class="error-message" *ngIf="errors.title">{{errors.title}}</span>
              </div>
              <div class="form-group">
                <label for="articleCategory">Danh mục</label>
                <select id="articleCategory" [(ngModel)]="newArticle.categoryId" name="categoryId" (ngModelChange)="logCategoryChange($event)" required>
  <option *ngFor="let category of categories; trackBy: trackByCategoryId" [ngValue]="category.id">
    {{category.name}}
  </option>
</select>
                <span class="error-message" *ngIf="errors.categoryId">{{errors.categoryId}}</span>
              </div>
            </div>
            <div class="form-group">
              <label for="articleContent">Nội dung</label>
              <textarea 
                id="articleContent" 
                [(ngModel)]="newArticle.content" 
                name="content" 
                placeholder="Nhập nội dung bài viết..."
                [ngClass]="{'invalid': errors.content}"></textarea>
              <span class="error-message" *ngIf="errors.content">{{errors.content}}</span>
            </div>
            <div class="form-row">
              <div class="form-group form-group-large">
                <label for="articleImage">URL ảnh</label>
                <input 
                  type="url" 
                  id="articleImage" 
                  [(ngModel)]="newArticle.image_url" 
                  name="image_url"
                  placeholder="https://example.com/image.jpg"
                  [ngClass]="{'invalid': errors.image_url}">
                <span class="error-message" *ngIf="errors.image_url">{{errors.image_url}}</span>
              </div>
              <div class="form-group">
                <label for="articleStatus">Trạng thái</label>
                <select id="articleStatus" [(ngModel)]="newArticle.status" name="status">
                  <option value="draft">Nháp</option>
                  <option value="published">Đã xuất bản</option>
                </select>
                <span class="error-message" *ngIf="errors.status">{{errors.status}}</span>
              </div>
            </div>
            <div class="form-actions">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i>
                {{editingArticle ? 'Cập nhật' : 'Tạo bài'}}
              </button>
              <button 
                *ngIf="editingArticle" 
                type="button" 
                class="btn btn-secondary" 
                (click)="cancelEditArticle()">
                <i class="fas fa-times"></i>
                Hủy
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Articles List -->
      <div class="content-card">
        <div class="card-header">
          <div class="card-title">
            <i class="fas fa-list"></i>
            <h5>Danh sách bài viết</h5>
          </div>
        </div>
        <div class="card-body">
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Tiêu đề</th>
                  <th>Trạng thái</th>
                  <th>Tác giả</th>
                  <th>Hành động</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let article of articles; trackBy: trackByArticleId">
                  <td>{{article.id}}</td>
                  <td class="title-cell">{{article.title}}</td>
                  <td>
                    <span class="status-badge" [class]="'status-' + article.status">
                      {{getArticleStatusText(article.status)}}
                    </span>
                  </td>
                  <td>{{article.author.username}}</td>
                  <td>
                    <div class="action-buttons">
                      <button class="btn-action btn-edit" (click)="startEditArticle(article)">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn-action btn-delete" (click)="deleteArticle(article.id)">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>

    <!-- Users Tab -->
    <div *ngIf="activeTab === 'users'" class="tab-content">
      <!-- User Form -->
      <div class="content-card">
        <div class="card-header">
          <div class="card-title">
            <i class="fas fa-plus-circle"></i>
            <h5>{{editingUser ? 'Chỉnh sửa người dùng' : 'Thêm người dùng mới'}}</h5>
          </div>
        </div>
        <div class="card-body">
          <form (ngSubmit)="editingUser ? editUser() : createUser()" class="user-form">
            <div class="form-row">
              <div class="form-group">
                <label for="username">Tên người dùng</label>
                <input 
                  type="text" 
                  id="username" 
                  [(ngModel)]="newUser.username" 
                  name="username" 
                  [disabled]="editingUser !== null" 
                  placeholder="Nhập tên người dùng"
                  [ngClass]="{'invalid': errors.username}">
                <span class="error-message" *ngIf="errors.username">{{errors.username}}</span>
              </div>
              <div class="form-group">
                <label for="userEmail">Email</label>
                <input 
                  type="email" 
                  id="userEmail" 
                  [(ngModel)]="newUser.email" 
                  name="email" 
                  placeholder="Nhập email"
                  [ngClass]="{'invalid': errors.email}">
                <span class="error-message" *ngIf="errors.email">{{errors.email}}</span>
              </div>
            </div>
            <div class="form-row">
              <div class="form-group">
                <label for="userPassword">Mật khẩu</label>
                <input 
                  type="password" 
                  id="userPassword" 
                  [(ngModel)]="newUser.password" 
                  name="password" 
                  placeholder="Nhập mật khẩu"
                  [ngClass]="{'invalid': errors.password}">
                <span class="error-message" *ngIf="errors.password">{{errors.password}}</span>
              </div>
              <div class="form-group">
                <label for="confirmPassword">Xác nhận mật khẩu</label>
                <input 
                  type="password" 
                  id="confirmPassword" 
                  [(ngModel)]="newUser.confirmPassword" 
                  name="confirmPassword" 
                  placeholder="Xác nhận mật khẩu"
                  [ngClass]="{'invalid': errors.confirmPassword}">
                <span class="error-message" *ngIf="errors.confirmPassword">{{errors.confirmPassword}}</span>
              </div>
            </div>
            <div class="form-group">
              <label for="userRole">Vai trò</label>
              <select id="userRole" [(ngModel)]="newUser.role" name="role">
                <option value="user">Người dùng</option>
                <option value="admin">Quản trị viên</option>
              </select>
              <span class="error-message" *ngIf="errors.role">{{errors.role}}</span>
            </div>
            <div class="form-actions">
              <button type="submit" class="btn btn-primary">
                <i class="fas fa-save"></i>
                {{editingUser ? 'Cập nhật' : 'Tạo'}}
              </button>
              <button 
                *ngIf="editingUser" 
                type="button" 
                class="btn btn-secondary" 
                (click)="cancelEditUser()">
                <i class="fas fa-times"></i>
                Hủy
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Users List -->
      <div class="content-card">
        <div class="card-header">
          <div class="card-title">
            <i class="fas fa-list"></i>
            <h5>Danh sách người dùng</h5>
          </div>
        </div>
        <div class="card-body">
          <div class="table-container">
            <table class="data-table">
              <thead>
                <tr>
                  <th>ID</th>
                  <th>Tên người dùng</th>
                  <th>Email</th>
                  <th>Vai trò</th>
                  <th>Ngày tạo</th>
                  <th>Hành động</th>
                </tr>
              </thead>
              <tbody>
                <tr *ngFor="let user of users; trackBy: trackByUserId">
                  <td>{{user.id}}</td>
                  <td>{{user.username}}</td>
                  <td>{{user.email}}</td>
                  <td>
                    <span class="role-badge" [class]="'role-' + user.role">
                      {{getUserRoleText(user.role)}}
                    </span>
                  </td>
                  <td>{{user.created_at ? (user.created_at | date:'short') : 'N/A'}}</td>
                  <td>
                    <div class="action-buttons">
                      <button class="btn-action btn-edit" (click)="startEditUser(user)">
                        <i class="fas fa-edit"></i>
                      </button>
                      <button class="btn-action btn-delete" (click)="deleteUser(user.id)">
                        <i class="fas fa-trash"></i>
                      </button>
                    </div>
                  </td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
